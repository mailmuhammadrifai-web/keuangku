<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Keuangku - AI Scanner Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #000; color: white; overflow: hidden; height: 100dvh; }
        
        /* Laser Scanner */
        .scanner-line {
            height: 3px;
            background: #22c55e;
            box-shadow: 0 0 15px #22c55e, 0 0 30px #22c55e;
            position: absolute;
            width: 100%;
            z-index: 40;
            top: 20%;
            animation: scanLoop 2s infinite ease-in-out;
            opacity: 0.8;
        }

        @keyframes scanLoop {
            0%, 100% { transform: translateY(0); opacity: 0.2; }
            50% { transform: translateY(50dvh); opacity: 1; }
        }

        .viewfinder-box {
            position: relative;
            z-index: 20;
            box-shadow: 0 0 0 2000px rgba(0, 0, 0, 0.7); /* Cinematic mask */
            border: 1px solid rgba(255,255,255,0.2);
        }

        #videoFeed {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            object-fit: cover;
            z-index: 10;
        }

        .shutter-btn:active { transform: scale(0.85); transition: 0.1s; }
        
        .neo-shadow { box-shadow: 4px 4px 0px #000; }
    </style>
</head>
<body class="flex flex-col">

    <video id="videoFeed" autoplay playsinline muted></video>

    <header class="absolute top-0 w-full p-6 flex justify-between items-center z-50">
        <a href="index.html" class="bg-black/50 backdrop-blur-xl p-3 rounded-2xl border border-white/20 active:scale-90 transition-all">
            <i data-lucide="arrow-left" class="w-6 h-6"></i>
        </a>
        <div class="bg-white px-4 py-2 rounded-full border-2 border-black flex items-center gap-2 neo-shadow">
            <span class="relative flex h-2 w-2">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
            </span>
            <span class="text-[10px] font-black text-black uppercase tracking-widest">AI Vision Active</span>
        </div>
        <button id="toggleFlash" class="bg-black/50 backdrop-blur-xl p-3 rounded-2xl border border-white/20 text-yellow-400">
            <i data-lucide="zap" class="w-6 h-6"></i>
        </button>
    </header>

    <main class="flex-1 relative flex items-center justify-center p-6 pointer-events-none">
        <div class="scanner-line"></div>
        <div class="w-full aspect-[3/4] viewfinder-box rounded-[2.5rem]">
            <div class="absolute -top-1 -left-1 w-12 h-12 border-t-8 border-l-8 border-indigo-500 rounded-tl-[2rem]"></div>
            <div class="absolute -top-1 -right-1 w-12 h-12 border-t-8 border-r-8 border-indigo-500 rounded-tr-[2rem]"></div>
            <div class="absolute -bottom-1 -left-1 w-12 h-12 border-b-8 border-l-8 border-indigo-500 rounded-bl-[2rem]"></div>
            <div class="absolute -bottom-1 -right-1 w-12 h-12 border-b-8 border-r-8 border-indigo-500 rounded-br-[2rem]"></div>
        </div>
    </main>

    <section class="relative bg-black p-8 pb-12 flex justify-around items-center z-50 rounded-t-[3rem] border-t-4 border-white/10">
        <button class="flex flex-col items-center gap-1 text-white/60">
            <div class="p-3 bg-white/10 rounded-full border border-white/10">
                <i data-lucide="image" class="w-6 h-6"></i>
            </div>
            <span class="text-[10px] font-bold uppercase">Galeri</span>
        </button>

        <button onclick="captureAction()" class="shutter-btn group">
            <div class="w-24 h-24 rounded-full border-4 border-white flex items-center justify-center p-1 shadow-[0_0_30px_rgba(99,102,241,0.4)]">
                <div class="w-full h-full rounded-full bg-white border-4 border-black group-active:bg-gray-200"></div>
            </div>
        </button>

        <button id="switchCam" class="flex flex-col items-center gap-1 text-white/60">
            <div class="p-3 bg-white/10 rounded-full border border-white/10">
                <i data-lucide="refresh-cw" class="w-6 h-6"></i>
            </div>
            <span class="text-[10px] font-bold uppercase">Putar</span>
        </button>
    </section>

    <div id="aiModal" class="fixed inset-0 bg-black/90 backdrop-blur-2xl z-[100] hidden items-center justify-center p-6">
        <div class="bg-white text-black w-full rounded-[3rem] p-8 border-4 border-black shadow-[10px_10px_0px_#6366f1] transform transition-all">
            <div class="flex flex-col items-center text-center">
                <div class="w-24 h-24 bg-indigo-50 rounded-full flex items-center justify-center mb-6 relative">
                    <div class="absolute inset-0 animate-ping bg-indigo-200 rounded-full opacity-30"></div>
                    <i data-lucide="brain-circuit" class="w-12 h-12 text-indigo-600"></i>
                </div>
                
                <h2 class="text-3xl font-black uppercase tracking-tighter italic">Scanning...</h2>
                <p id="statusText" class="text-xs font-bold text-gray-400 mb-8 uppercase">Membaca Data Transaksi</p>
                
                <div class="w-full h-4 bg-gray-100 rounded-full border-2 border-black overflow-hidden mb-8">
                    <div id="pBar" class="h-full bg-green-400 border-r-2 border-black transition-all duration-300 w-0"></div>
                </div>

                <div id="resultCard" class="hidden w-full bg-yellow-100 p-5 rounded-3xl border-2 border-black mb-8 animate-bounce">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-black text-xs uppercase opacity-50">Total Nota</span>
                        <span class="bg-black text-white text-[10px] px-2 py-0.5 rounded-full">AI CONFIDENT 98%</span>
                    </div>
                    <p class="text-3xl font-black italic uppercase">Rp 450.000</p>
                </div>

                <button id="doneBtn" onclick="window.location.href='index.html'" class="hidden w-full bg-black text-white py-5 rounded-2xl font-black uppercase tracking-widest active:translate-y-1">
                    Masuk Laporan Cuan
                </button>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();
        
        const video = document.getElementById('videoFeed');
        let currentStream;
        let useBackCamera = true;

        // Start Camera Function
        async function initCamera() {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
            }
            try {
                const constraints = {
                    video: { facingMode: useBackCamera ? "environment" : "user" }
                };
                currentStream = await navigator.mediaDevices.getUserMedia(constraints);
                video.srcObject = currentStream;
            } catch (err) {
                console.error("Kamera error:", err);
                alert("Waduh! Izin kamera ditolak. Aktifkan di pengaturan browser ya!");
            }
        }

        // Flash/Torch Toggle (Hanya jalan di beberapa browser Android)
        document.getElementById('toggleFlash').onclick = async () => {
            const track = currentStream.getVideoTracks()[0];
            const capabilities = track.getCapabilities();
            if (capabilities.torch) {
                const isTorchOn = track.getSettings().torch;
                await track.applyConstraints({
                    advanced: [{ torch: !isTorchOn }]
                });
            } else {
                alert("HP kamu nggak support senter via browser nih ðŸ˜…");
            }
        };

        // Switch Camera
        document.getElementById('switchCam').onclick = () => {
            useBackCamera = !useBackCamera;
            initCamera();
        };

        // Capture Process
        function captureAction() {
            // Haptic Feedback (Vibrate)
            if (navigator.vibrate) navigator.vibrate(50);
            
            const modal = document.getElementById('aiModal');
            const bar = document.getElementById('pBar');
            const res = document.getElementById('resultCard');
            const btn = document.getElementById('doneBtn');
            const status = document.getElementById('statusText');

            modal.classList.remove('hidden');
            modal.classList.add('flex');

            let width = 0;
            const step = () => {
                width += Math.random() * 15;
                if (width > 100) width = 100;
                bar.style.width = width + '%';
                
                if (width < 40) status.innerText = "Mendeteksi Teks...";
                else if (width < 80) status.innerText = "Menghitung Nominal...";
                else status.innerText = "Finalisasi Data...";

                if (width < 100) {
                    setTimeout(step, 200);
                } else {
                    res.classList.remove('hidden');
                    btn.classList.remove('hidden');
                    status.innerText = "Berhasil Discan!";
                }
            };
            step();
        }

        initCamera();
    </script>
</body>
</html>
